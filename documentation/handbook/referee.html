<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML><HEAD>

<script type="text/javascript" src="/static/js/analytics.js" ></script>
<link type="text/css" rel="stylesheet" href="/static/css/banner-styles.css"/>



<TITLE>Volity Wiki: Referee</TITLE>
<META NAME='KEYWORDS' CONTENT='Referee'/>
<LINK REL="stylesheet" HREF="/web/20070802131051cs_/http://volity.org/main.css">
</HEAD><BODY BGCOLOR="white">


<div class=wikiheader><h1><a href="/web/20070802131051/http://volity.org/wiki/index.cgi?back=Referee">Referee</a></h1><a href="/web/20070802131051/http://volity.org/wiki/index.cgi?HomePage" class=wikipagelink>HomePage</a> | <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?RecentChanges" class=wikipagelink>RecentChanges</a> | <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?action=editprefs">Preferences</a> | <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?action=upload">Upload</a><br>
<hr class=wikilineheader></div><div class=wikitext>A Volity <strong>referee</strong> is a <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?Jabber_Entity" class=wikipagelink>Jabber entity</a> that sits at every <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?Table" class=wikipagelink>table</a>, acting as the point of communication between a <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?Game" class=wikipagelink>game</a> and its <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?Player" class=wikipagelink>player</a>s.
<p>
In fact, the referee <em>is</em> the game, to a great degree, since the current state of any table's game is known wholly by the referee, and it must describe the game individually to each player. It does this by sending <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?Jabber-RPC" class=wikipagelink>Jabber-RPC</a> requests to a player whenever the game state changes from that player's perspective; these requests, on receipt, trigger ECMAScript functions found within the <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?UI_File" class=wikipagelink>UI file</a> currently loaded on the player's client, which in turn causes something appropriate to happen before the player's eyes: the scoreboard is updated, or a card is dealt, or a piece is captured.
<p>
The referee is also the target of communication from the player to the game. For instance, a player's current UI might display a "Roll dice" button, or an animated image of the dice themselves, which, when clicked, send a <code>game.roll_dice</code> RPC request to the table's referee. Typically, the referee would respond by determining the die roll through its own internal methods, then sending to that player's client (or all players, if the roll isn't secret) another RPC request that confides the roll's result.
<p>
<H2>Referee as GM</H2>

<p>
Those familiar with tabletop  roleplaying games, such as Dungeons &amp; Dragons, might  appreciate the metaphor comparing a Volity referee to a game master. It holds the whole game concept, and its  current state, "in its head", and its the sole interface between the players and the game world, continually updating their current perspective on it. Players are free to talk to each other, but to make anything happen  in the game world, they have to to talk to the referee, who lets them know what happens as a result.
<p>
<H2>Current Implementations</H2>

<p>
Frameworks that implement a referee (in Perl and Python) are available from the <a href="/web/20070802131051/http://volity.org/downloads.html">[developer download page.]</a> (These frameworks are labelled "parlor software", but in fact they contain both the <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?Parlor" class=wikipagelink>parlor</a> and <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?Referee" class=wikipagelink>referee</a>. The parlor's job is to create referees on demand.)
<p>
If you want to create a Volity game, you do not have to implement the entire referee from scratch. Download one of these frameworks, and then extend the base Game class to implement your game logic.
<p>
<H2><a href="/web/20070802131051/http://volity.org/wiki/index.cgi?RPC_Requests" class=wikipagelink>RPC Requests</a></H2>

<p>
<p>
The following faults can be generated by any referee method:
<UL >
<li> Fault: 609: referee is not yet running (MUC is not yet fully configured)
<li> Fault: 609: game is in progress
<li> Fault: 607: sender is not present at the table (not a member of the MUC)
</UL>
<p>
Since only clients call methods on referees, all return values for these methods take the flag-led array format described on the <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?RPC_Replies" class=wikipagelink>RPC replies</a> page. Therefore, all return values listed in this section actually refer to array values that go after the "volity.ok" flag. 
<p>
Possible non-fault errors are listed under separate "Denial" entries, with the flag token that identifies the error (and appears instead of "volity.ok" in the return array). The flag may be followed by additional <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?Token" class=wikipagelink>token</a>s, as described (or not) in each case.
<p>
<H3>volity.add_bot ()</H3>

<p>
Requests that the referee add a <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?Retainer" class=wikipagelink>retainer</a> bot to the table. The response is a fault (with an explanatory message attached) if the referee cannot add a bot to the table right now. Otherwise, the response is the full JID of the bot which was created.
<p>
The bot is initially unseated; the players are responsible for seating it appropriately.
<p>
<UL >
<li> Returns: the bot's full JID.
<li> Denial: volity.no_bots_provided: The parlor does not provide any bots.
</UL>
<p>
<H3>volity.add_bot ( <em>URI</em>, <em>JID</em> )</H3>

<p>
Same as above, but requests a specific bot -- that is, a bot with a specific bot algorithm URI -- from a specific factory. If <em>JID</em> is the empty string, the parlor JID, or the referee JID (all equivalent for this purpose) then the request is directed at the parlor itself. If not, the request is directed at an external <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?Bot_Factory" class=wikipagelink>bot factory</a>.
<p>
<UL >
<li> Returns: the bot's full JID.
<li> Denial: volity.no_bots_provided: The parlor does not provide any bots.
<li> Denial: volity.bot_not_available: The <em>URI</em> does not match any bots available from the parlor or factory.
<li> Denial: volity.relay_failed: The request could not be passed along to the factory.
</UL>
<p>
<H3>volity.remove_bot ( <em>JID</em> )</H3>

<p>
Request that the referee remove the <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?Retainer" class=wikipagelink>retainer</a> bot with the given JID from the table. This only works on bots that were added with volity.add_bot(), and it only works if the bot is unseated. If the bot is managed by an external <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?Bot_Factory" class=wikipagelink>bot factory</a>, this causes a volity.leave_table() call to the bot.
<p>
<UL >
<li> Returns: nothing.
<li> Denial: volity.jid_not_present: The JID is not present at the table.
<li> Denial: volity.not_bot: The JID refers to a human player, not a bot.
<li> Denial: volity.bot_seated: The JID refers to a bot which is seated.
</UL>
<p>
<H3>volity.ready ()</H3>

<p>
This method signals that the player who made this request accepts the current <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?Table_Configuration" class=wikipagelink>table configuration</a> and is ready to begin playing a new game there. The referee will begin the game only when all the players have so signalled.
<p>
If the referee is unwilling to start a new game with the table's current setup, it will deny the request with one of the flags listed below. The player is effectively signaling approval for a game configuration that can't actually be played.
<p>
Otherwise, the referee will report the player's readiness to all players in the MUC, by sending volity.player_ready.
<p>
Any change in the table's configuration cancels any previously sent ready signals.
<p>
<UL >
<li> Returns: nothing.
<li> Fault: 609: No humans are seated at the table.
<li> Denial: volity.bad_config: The current table configuration cannot support a new game.
<li> Denial: volity.empty_seats: There are mandatory seats yet to be filled.
</UL>
<p>
<H3>volity.unready ()</H3>

<p>
Signals that the sending player is not ready to begin playing, and thus delay the game from starting. This is mainly useful should the player change his or her mind after sending a <code>volity.ready</code> request. If the player is already unready, this does nothing.
<p>
If this succeeds, the referee will report it to all players in the MUC, by sending volity.player_unready.
<p>
<UL >
<li> Returns: nothing.
</UL>
<p>
<H3>volity.stand ( <em>JID</em> )</H3>

<p>
Requests the referee to remove the player with the given JID from his seat. Effectively, the player becomes an <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?Game_Observation" class=wikipagelink>observer</a>.
<p>
If the player is already standing, this succeeds and does nothing.
<p>
<UL >
<li> Returns: nothing.
<li> Fault: 606: JID is not present at table (not a member of the MUC)
</UL>
<p>
<H3>volity.sit ( <em>JID</em> )</H3>

<p>
<em>This method is distinct from the argument-taking form described below.</em>
<p>
Requests the referee to assign a <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?Seats" class=wikipagelink>seat</a> to the player with the given JID. Usually, this is equivalent to wishing to join the game as a solitary player, rather than sharing a seat with existing players.
<p>
The player referred to by the JID will most often be the same as that of the sending user -- that is, this request will usually result from a player wishing to seat itself. However, a player that has tasked itself with setting up the table and assigning seats might make this call on behalf of another player, using that other player's JID. Referees must pay attention to the difference, but it is ultimately up to them how to respond to requests to seat other players.
<p>
If the referee decides that the named player can indeed sit down, its return value (after the required <code>volity.ok</code> token) is the ID of the new seat. The referee can use any method to select which of its empty seats the player should join, but it SHOULD favor any empty required seats over other empty seats.
<p>
If the player was already seated elsewhere, he is removed from that seat when he is placed in the new one. If he was already seated in the given seat, this does nothing (but still returns the seat ID).
<p>
<UL >
<li> Returns: seat ID
<li> Fault: 606: JID is not present at table (not a member of the MUC)
<li> Denial: volity.no_seat: There are no empty seats available at this table.
<li> Denial: volity.jid_not_ready: The named player has not yet sent his first volity.send_state RPC, and therefore is not yet eligible for seating.
</UL>
<p>
<H3>volity.sit ( <em>JID</em>, <em>seat-id</em> )</H3>

<p>
<em>This method is distinct from the non-argument-taking form described above.</em>
<p>
Requests that the player with the given JID be seated in the seat with the given ID.
<p>
The player referred to by the JID will most often be the same as that of the sending user -- that is, this request will usually result from a player wishing to seat itself. However, a player that has tasked itself with setting up the table and assigning seats might make this call on behalf of another player, using that other player's JID. Referees must pay attention to the difference, but it is ultimately up to them how to respond to requests to seat other players.
<p>
If the referee decides that the named player can indeed sit down in that seat, its return value, is the ID of that seat (as with the non-argument-taking form of this method).
<p>
If the player is already seated, this does nothing (but still returns his seat ID).
<p>
<UL >
<li> Returns: seat ID
<li> Fault: 606: JID is not present at table (not a member of the MUC)
<li> Fault: 606: No such seat at this table.
<li> Denial: volity.jid_not_ready: The named player has not yet sent his first volity.send_state RPC, and therefore is not yet eligible for seating.
</UL>
<p>
<H3>volity.suspend_game ( )</H3>

<p>
Requests that the the referee <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?Game_Suspension" class=wikipagelink>suspend the game</a>. Only seated players can succeed in calling this, and only when the game is active.
<p>
<UL >
<li> Returns: nothing
<li> Fault: 609: The game isn't active.
<li> Fault: 607: You're not seated. [ Sent if the player is standing. ]
</UL>
<p>
<H3>volity.send_state()</H3>

<p>
Requests the the referee send <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?State_Recovery" class=wikipagelink>state recovery</a> information to the player. Anyone at the table can call this, at any time.
<p>
The client also uses this to inform the referee that it is a Volity client, and not a mere Jabber client. Before the first volity.send_state() call, the referee will refrain from sending RPCs to the client. After that first <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?State_Recovery" class=wikipagelink>state recovery</a> blast, the referee will keep the client up to date with all game state changes.
<p>
<UL >
<li> Returns: nothing
</UL>
<p>
<H3>volity.show_table ( true | false )</H3>

<p>
Requests that the table be available through the <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?Game_Browser" class=wikipagelink>game browser</a> (if the argument is <code>true</code>) or not (if the argument is <code>false</code>).
<p>
The default for new tables is <code>true</code>.
<p>
This is a <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?Table_Configuration" class=wikipagelink>table configuration</a> request. The referee will accept it only prior to the start of a game. Changing this value will result in the referee setting all seated players to <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?Readiness" class=wikipagelink>unready</a>.
<p>
<UL >
<li> Returns: boolean
</UL>
<p>
<H3>volity.record_games ( true | false )</H3>

<p>
Requests that the referee send <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?Game_Record" class=wikipagelink>game record</a>s to the <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?Bookkeeper" class=wikipagelink>bookkeeper</a> at the end of each game (if the argument is <code>1</code>) or not (if the argument is <code>0</code>).
<p>
The default for new tables is <code>true</code>.
<p>
This is a <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?Table_Configuration" class=wikipagelink>table configuration</a> request. The referee will accept it only prior to the start of a game. Changing this value will result in the referee setting all seated players to <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?Readiness" class=wikipagelink>unready</a>.
<p>
<UL >
<li> Returns: nothing
</UL>
<p>
<H3>volity.set_language ( <em>language</em> )</H3>

<p>
Requests a change of the table's preferred <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?Language" class=wikipagelink>language</a>. The argument is a two-letter language code.
<p>
This is a <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?Table_Configuration" class=wikipagelink>table configuration</a> request. The referee will accept it only prior to the start of a game. Changing this value will result in the referee setting all seated players to <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?Readiness" class=wikipagelink>unready</a>.
<p>
<UL >
<li> Returns: nothing
</UL>
<p>
<H3>volity.kill_game ( true | false )</H3>

<p>
If the one argument is true, this special config method requests that the game be <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?Killing_Games" class=wikipagelink>killed</a> after all active players have indicated readiness.
<p>
If it's false, then it requests that the game play resume normally upon all players' readiness.
<p>
This is a <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?Table_Configuration" class=wikipagelink>table configuration</a> request. The referee will accept it only when <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?Game_Suspension" class=wikipagelink>suspended</a>. Changing this value will result in the referee setting all seated players to <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?Readiness" class=wikipagelink>unready</a>.
<p>
<UL >
<li> Returns: nothing
<li> Fault: 609: The game is active.
<li> Fault: 607: You're not seated. [ Sent if the player is standing. ]
</UL>
<p>
<H3>volity.invite_player ( <em>JID</em> )</H3>

<p>
Requests that the referee invite the player <em>JID</em> to join the table.
<p>
The referee responds by sending an <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?Invitation" class=wikipagelink>invitation</a> to the specified player. If the JID has a resource string, this will be an <code>volity.receive_invitation</code> RPC. If it lacks a resource string, it will be a <code>&lt;message&gt;</code> packet containing an <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?Invitation" class=wikipagelink>invitation</a> data form.
<p>
<UL >
<li> Returns: true when the invitation has been successfully sent.
<li> Denial: volity.relay_failed if an RPC invitation could not be sent.
</UL>
<p>
<H3>volity.invite_player ( <em>JID</em>, <em>message</em> )</H3>

<p>
Requests that the referee invite the player <em>JID</em> to join the table. The <em>message</em> is an additional string, containing a message from the inviter to the invitee.
<p>
The referee responds by sending an <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?Invitation" class=wikipagelink>invitation</a> to the specified player. If the JID has a resource string, this will be an <code>volity.receive_invitation</code> RPC. If it lacks a resource string, it will be a <code>&lt;message&gt;</code> packet containing an <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?Invitation" class=wikipagelink>invitation</a> data form.
<p>
<UL >
<li> Returns: true when the invitation has been successfully sent.
<li> Denial: volity.relay_failed if an RPC invitation could not be sent.
</UL>
<p>
<H3>Game RPCs</H3>

<p>
Note that all the above RPC requests lay in the <code>volity</code> namespace, marking them as systemwide methods. Another Volity RPC namespace, <code>game</code>, serves as the container for game-specific requests; that is, requests defined by a certain <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?Ruleset" class=wikipagelink>ruleset</a>.
<p>
<code>game.*</code> RPCs never implicitly cause players to become unready. If the game configuration changes, the referee will send out a burst of <code>volity.player_unready</code> RPCs.
<p>
<H3>Administrative RPCs</H3>

<p>
The referee may also respond to various <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?Admin_RPC_Requests" class=wikipagelink>admin RPC requests</a>.
<p>
<H2><a href="/web/20070802131051/http://volity.org/wiki/index.cgi?Service_Discovery" class=wikipagelink>Service Discovery</a> responses</H2>

<p>
Referees should respond to <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?Service_Discovery" class=wikipagelink>disco</a> requests as follows:
<p>
<H3>Info</H3>

<p>
The referee's identity should have <strong>category</strong> "volity" and <strong>type</strong> "referee". The <strong>name</strong> field holds a description of this table, generally set by the player who created it. <em>Except there's currently no way for the player to set this. --<a href="/web/20070802131051/http://volity.org/wiki/index.cgi?Zarf" class=wikipagelink>Zarf</a></em>
<p>
The attached <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?JEPs_That_Volity_Uses" class=wikipagelink>JEP-0128</a> form contains the following additional fields:
<p>
<DL >
<dt>volity-role<dd> The string <code>referee</code>.
<dt>parlor<dd> The <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?JID" class=wikipagelink>JID</a> of this referee's <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?Parlor" class=wikipagelink>parlor</a>.
<dt>table<dd> The JID of this referee's table (MUC).
<dt>state<dd> One of the five <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?Referee_States" class=wikipagelink>referee state</a> strings.
<dt>players<dd> The number of occupied <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?Seats" class=wikipagelink>seats</a> at the table.
<dt>max-players<dd> How many seats this referee will allow.
<dt>language<dd> The preferred human <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?Language" class=wikipagelink>language</a> for this table, expressed as a two-letter <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?Language_Code" class=wikipagelink>language code</a>
<dt>recorded<dd> 1 if the referee is recording games on the bookkeeper; 0 otherwise.
<dt>visible<dd> 1 if the table is visible to the game finder; 0 otherwise.
</DL>
<p>
<H3>Items</H3>

<p>
Empty list. However, sending a disco-items query to the <em>table</em> will result in a list of pointers to the players within (as well as the referee), just like any other Jabber <a href="/web/20070802131051/http://volity.org/wiki/index.cgi?MUC" class=wikipagelink>MUC</a> responds with a list of chat participants.
</div>